<!DOCTYPE html>
<html lang="ta">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Donate via UPI</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        form { max-width: 400px; margin: auto; background: #f9f9f9; padding: 20px; border-radius: 8px; }
        input, button { width: 100%; padding: 10px; margin: 10px 0; }
        button { background: green; color: white; border: none; cursor: pointer; }
        button:hover { background: darkgreen; }
    </style>
</head>
<body>

    <h2>பொருளாதார உதவி வழங்க</h2>
    <p>உங்கள் சிறிய பங்களிப்பால் பெரிய மாற்றத்தை உருவாக்க முடியும்.</p>

    <form id="donationForm">
        <input type="text" name="name" placeholder="பெயர் (Name)" required>
        <input type="text" name="amount" placeholder="நன்கொடை தொகை (Donation Amount)" required>
        <input type="text" name="transactionId" placeholder="UPI பரிவர்த்தனை ஐடி (Transaction ID)" required>
        <button type="submit">நன்கொடை வழங்க (Donate)</button>
    </form>

    <script>
        const GITHUB_REPO = "nit-cms";
        const GITHUB_USERNAME = "Webakery";
        const GITHUB_FILE_PATH = "public/donations.json";
        const GITHUB_ACCESS_TOKEN = "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";  // Replace with your token

        document.getElementById("donationForm").addEventListener("submit", async function (e) {
            e.preventDefault();

            const formData = new FormData(this);
            const newDonation = {
                name: formData.get("name"),
                amount: formData.get("amount"),
                transactionId: formData.get("transactionId"),
                date: new Date().toISOString()
            };

            try {
                // Fetch the existing donations.json file from GitHub
                const response = await fetch(`https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPO}/contents/${GITHUB_FILE_PATH}`, {
                    headers: { Authorization: `token ${GITHUB_ACCESS_TOKEN}` }
                });

                const fileData = await response.json();
                const existingData = JSON.parse(atob(fileData.content));

                // Add new donation to the list
                existingData.push(newDonation);

                // Convert updated data to base64
                const updatedContent = btoa(JSON.stringify(existingData, null, 2));

                // Update the JSON file on GitHub
                await fetch(`https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPO}/contents/${GITHUB_FILE_PATH}`, {
                    method: "PUT",
                    headers: {
                        Authorization: `token ${GITHUB_ACCESS_TOKEN}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        message: "New donation added",
                        content: updatedContent,
                        sha: fileData.sha
                    })
                });

                alert("நன்கொடை பதிவு செய்யப்பட்டது! (Donation saved)");
                this.reset();
            } catch (error) {
                alert("பிழை: (Error saving donation) " + error.message);
            }
        });
    </script>

</body>
</html>
